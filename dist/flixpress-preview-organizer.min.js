/*! flixpress-preview-organizer - v0.1.0 - 2015-04-27
* Copyright (c) 2015 Don Denton; Licensed MIT */
!function(a){var b=4,c=4;a.fn.flixpressPreviewOrganizer=function(){return this.each(function(){var d=a(this),e=d.find(".OrderItemDiv"),f=e.slice(0,b),g=e.slice(b);f.wrapAll('<div class="recent-orders"></div>'),g.wrapAll('<div class="past-orders"></div>');var h=d.find(".recent-orders"),i=d.find(".past-orders");h.prepend("<h2>Recent Previews</h2>"),i.prepend("<h2>Past Previews Grouped By Template</h2>");var j=[],k=function(b,c,d){var e=!0;if(a.each(j,function(a,c){c.name===b&&(j[a].elements.push(d),e=!1)}),e){var f={name:b,imgSrc:c,elements:[d]};j.push(f)}};a.each(g,function(b,c){var d=a(c).find(".TemplateImageDiv img").attr("src"),e=/([^\/]*).(jpg|png|jpeg)$/i,f=d.match(e)[1];k(f,d,c)}),a.each(j,function(b,d){b%c===0&&i.append('<div class="past-orders-group"><div class="arrow-up"></div></div>');var e=i.find(".past-orders-group:last");e.before('<div id="past-orders-group-'+d.name+'" class="template-folder"><div class="OrderItemDiv"></div><div class="OrderItemDiv"><img src="'+d.imgSrc+'" /><span class="action-message">Click to Expand</span></div></div>'),e.append('<div class="past-orders-group-'+d.name+'"></div>'),a.each(d.elements,function(b,c){i.find(".past-orders-group-"+d.name).append(a(c))})}),d.on("click",".template-folder",function(b){var c=a(this).attr("id"),e=a(b.currentTarget).position().left;a(this).hasClass("opened")?a(this).removeClass("opened"):(d.find(".template-folder.opened").removeClass("opened"),a(this).addClass("opened")),a(".template-folder").find("span.action-message").text("Click to Expand"),a(".template-folder.opened").find("span.action-message").text("Click to Close"),d.find(".past-orders-group > div").not(".arrow-up").stop().hide("blind"),d.find(".arrow-up").hide(),d.find("."+c).stop().show("blind");var f=d.find("."+c).closest(".past-orders-group").find(".arrow-up");d.find(".template-folder.opened").length>0?f.stop().show().css({left:e}):f.hide()}),d.find(".RadDataPager").remove()})}}(jQuery);